layout {
    cwd "~/dotfiles"
    tab name="Updates" split_direction="vertical" {
        pane split_direction="horizontal" {
            pane {
                name "brew"
                command "zsh"
                args "updater.sh" "brew" r#"
                    set -e
                    echo 'Updating brew'
                    brew update
                    echo 'upgrading brew'
                    brew upgrade
                    brew upgrade --cask claude-code
                    echo 'brew cleanup'
                    brew cleanup --prune=all"#
                close_on_exit true
            }
            pane {
                name "cargo"
                command "zsh"
                args "updater.sh" "cargo" r#"
                    export OPENSSL_DIR="$(brew --prefix openssl@3)"
                    export PKG_CONFIG_PATH="$(brew --prefix libgit2)/lib/pkgconfig:${OPENSSL_DIR}/lib/pkgconfig"
                    export LIBGIT2_NO_VENDOR=1
                    export RUSTFLAGS="-C link-arg=-liconv"
                    cargo install-update -a"#
                close_on_exit true
            }
            pane {
                name "node"
                command "zsh"
                args "updater.sh" "node" "npm update -g"
                close_on_exit true
            }
        }
        pane split_direction="horizontal" {
            pane {
                name "rust"
                command "zsh"
                args "updater.sh" "rust" "rustup update stable"
                close_on_exit true
            }
            pane {
                name "tldr"
                command "zsh"
                args "updater.sh" "tldr" "tldr -u"
                close_on_exit true
            }
            pane {
                name "ruby"
                command "zsh"
                args "updater.sh" "ruby" "gem update"
                close_on_exit true
            }
            pane {
                name "go"
                command "zsh"
                args "updater.sh" "go" r#"
                    for bin in $(ls "$(go env GOPATH)/bin"); do
                        mod_path=$(go version -m "$(go env GOPATH)/bin/$bin" 2>/dev/null | awk '/^\s+path/ {print $2}')
                        if [ -n "$mod_path" ]; then
                            echo "Updating $mod_path"
                            go install "$mod_path@latest"
                        fi
                    done"#
                close_on_exit true
            }
        }
        pane split_direction="horizontal" {
            pane {
                name "Oh my zsh"
                command "zsh"
                args "-i" "updater.sh" "oh-my-zsh" "omz update"
                close_on_exit true
            }
            pane {
                name "Compute bound"
                command "zsh"
                args "updater.sh" "compute-bound" r#"
                    echo 'Copying bookmarks'
                    uv run copy_bookmarks.py
                    echo 'Cleaning mailhog log'
                    uv run clean-hog.py
                    echo 'deleting old uv cache'
                    find ~/.cache/uv -type f -mtime +30 -delete
                    find ~/.cache/uv -type d -empty -delete"#
                close_on_exit true
            }
            pane {
                name "update uv tools"
                command "zsh"
                args "updater.sh" "uv-tools" r#"echo "$(uv tool list | rg -o '^\w+')" | xargs uv tool upgrade"#
                close_on_exit true
            }
        }
    }
}
